<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Home Lab — Angel Vasquez</title>

  <!-- Reuse your site styles -->
  <link rel="stylesheet" href="style.css" />

  <!-- Minimal Markdown renderer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    /* Page-specific light styling that fits your theme */
    .lab-wrapper { max-width: 1100px; margin: 0 auto; padding: 2rem 1rem; }
    .lab-grid { display: grid; gap: 1.1rem; }
    .lab-card {
      background: var(--card, #121318);
      border: 1px solid var(--border, rgba(255,255,255,.08));
      border-radius: 16px;
      padding: 1rem;
      box-shadow: var(--shadow, 0 10px 30px rgba(0,0,0,.35));
    }
    .lab-card h2 { margin: .2rem 0 .6rem }
    .toc { display:flex; flex-wrap:wrap; gap:.5rem; margin:.5rem 0 1rem }
    .toc a {
      padding:.35rem .6rem; border:1px solid var(--border, rgba(255,255,255,.08));
      border-radius:999px; text-decoration:none
    }
    .lab-card img { max-width: 100%; height: auto; border-radius: 8px; }
    pre { overflow:auto; }
    .muted { color: var(--muted, #9aa3b2); }
  </style>
</head>
<body>
  <!-- Header reused from your site -->
  <header class="site-header">
    <nav class="nav container">
      <div>
        <h1 class="logo">Angel Vasquez</h1>
        <p>Cybersecurity Student • Problem Solver • Lifelong Learner</p>
      </div>
      <ul class="nav-links">
        <li><a href="index.html#about">About</a></li>
        <li><a href="index.html#projects">Projects</a></li>
        <li><a href="index.html#resume">Resume</a></li>
        <li><a href="index.html#contact">Contact</a></li>
        <li><a href="blog.html">Blog</a></li>
        <li><a aria-current="page" href="homelab.html">Home Lab</a></li>
      </ul>
    </nav>
  </header>

  <main class="lab-wrapper">
    <h1>Home Lab</h1>
    <p class="tagline muted">Notes and configs from my networking, VLAN, VPN, and router builds.</p>

    <div class="lab-card">
      <strong>On this page</strong>
      <div id="toc" class="toc"></div>
    </div>

    <div id="content" class="lab-grid"></div>
  </main>

  <footer class="site-footer">
    <p>© 2025 Angel Vasquez</p>
  </footer>

  <script>
    // ==== Configure your sections (exact file names in notes/homelab/) ====
    const BASE = "notes/homelab/";
    const SECTIONS = [
      { id: "overview", title: "The Home Lab (Overview)", file: "The Home Lab.md" },
      { id: "gmk",      title: "GMK Tech Mini PC (Router)", file: "GMK Tech Mini PC (router).md" },
      { id: "modem",    title: "Hitron Cable Modem",        file: "Hitron cable modem.md" },
      { id: "desktop",  title: "My Main Desktop",           file: "My main desktop.md" },
    ];

    // Build a lookup so Obsidian [[links]] to note titles can jump to the right section
    const titleToAnchor = Object.fromEntries(
      SECTIONS.map(s => [s.title.toLowerCase().replace(/\s+/g,' ').trim(), `#${s.id}`])
    );

    // Encode a *single path segment* (preserves slashes, encodes spaces, parentheses, etc.)
    const joinEncoded = (base, segment) => base + encodeURIComponent(segment).replace(/%2F/gi,'/');

    // Convert Obsidian syntax to web-friendly Markdown
    function preprocessObsidian(md) {
      // 1) Image embeds: ![[file.png]] or ![[folder/file.png|alt]]
      // -> ![](notes/homelab/assets/file.png)
      md = md.replace(/!\[\[([^|\]]+)(?:\|([^]]*))?\]\]/g, (_m, file, alt) => {
        const clean = String(file).trim();
        const url = joinEncoded(BASE + "assets/", clean);
        return `![${alt ? alt.trim() : ""}](${url})`;
      });

      // 2) Internal links: [[Title]] or [[Title|Text]] -> anchor if we have a matching section
      md = md.replace(/\[\[([^|\]]+)(?:\|([^]]+))?\]\]/g, (_m, target, text) => {
        const t = String(target).trim().toLowerCase().replace(/\s+/g,' ');
        const href = titleToAnchor[t] || '#';
        return `[${(text || target).trim()}](${href})`;
      });

      return md;
    }

    async function render() {
      const content = document.getElementById("content");
      const toc = document.getElementById("toc");

      // Build TOC
      toc.innerHTML = SECTIONS.map(s => `<a href="#${s.id}">${s.title}</a>`).join("");

      // Fetch + render each section
      for (const s of SECTIONS) {
        const card = document.createElement("section");
        card.className = "lab-card";
        card.id = s.id;

        try {
          const res = await fetch(joinEncoded(BASE, s.file));
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          let md = await res.text();
          md = preprocessObsidian(md);

          // Render with marked
          const html = marked.parse(md);
          card.innerHTML = `<h2>${s.title}</h2>${html}`;
        } catch (e) {
          card.innerHTML = `
            <h2>${s.title}</h2>
            <p class="muted">Could not load <code>${BASE}${s.file}</code> (${e.message}).<br>
            Make sure the file exists in your repo and the name & casing match exactly.</p>`;
        }

        content.appendChild(card);
      }
    }

    render();
  </script>
</body>
</html>
